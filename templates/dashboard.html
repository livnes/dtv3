{% extends "base.html" %}

{% block title %}砖专 - Data Talk{% endblock %}

{% block content %}
<!-- Main Header -->
<div class="main-header">
    <h1 class="welcome-title">砖 {{ user.name }}!</h1>
    <p class="welcome-subtitle">  驻砖专 注专  拽   ?</p>
</div>

<!-- Search Section -->
<div class="search-section">
    <div class="search-container">
        <input type="text" 
               class="search-input" 
               id="searchInput"
               placeholder="专 转  拽  转 专爪 拽..."
               autocomplete="off">
        <button class="search-submit" onclick="performSearch()">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>

    <!-- Quick Actions Pills -->
    <div class="quick-actions" id="quickActions">
        <!-- Active Actions -->
        <a href="/action/traffic-quality" class="action-pill" data-description="转 注拽 砖 拽专转 转注 砖 转 拽专  转 转专 砖">
            <i class="fas fa-trophy"></i>
            拽专转 转注 转
        </a>
        
        <a href="/action/search-keywords" class="action-pill" data-description="  转 驻砖    专 转注   砖驻专 转 专">
            <i class="fas fa-search"></i>
            转 驻砖 转
        </a>

        <!-- Coming Soon Actions -->
        <div class="action-pill" data-description="转 转砖 注 砖拽注 -  注专抓 驻专住 专   专 住祝" onclick="showComingSoon('ROI Analysis')">
            <i class="fas fa-dollar-sign"></i>
            转 ROI
        </div>

        <div class="action-pill" data-description="转 砖驻 专转 - 驻 转  住祝 砖驻 专转" onclick="showComingSoon('Conversion Funnel')">
            <i class="fas fa-funnel-dollar"></i>
            砖驻 专转
        </div>

        <div class="action-pill" data-description="驻爪 转拽爪转 -  拽 转 转拽爪 驻专住  拽住 专" onclick="showComingSoon('Budget Optimization')">
            <i class="fas fa-chart-pie"></i>
            驻爪 转拽爪转
        </div>

        <div class="action-pill" data-description="转 爪注 拽驻 -  拽驻 砖 爪注 驻住拽 " onclick="showComingSoon('Campaign Analysis')">
            <i class="fas fa-bullhorn"></i>
            爪注 拽驻
        </div>

        <div class="action-pill" data-description="转 专 转 砖 -   注砖 注祝" onclick="showComingSoon('Industry Trends')">
            <i class="fas fa-trending-up"></i>
            专 转
        </div>

        <div class="action-pill" data-description="转 转 -  转 注  专 拽专  专转" onclick="showComingSoon('Content Performance')">
            <i class="fas fa-newspaper"></i>
            爪注 转
        </div>
    </div>
</div>

<!-- Recent Analysis Results (if any) -->
{% if recent_analysis %}
<div class="analysis-section">
    <div class="results-container">
        <div class="results-header">
            <i class="fas fa-clock"></i>
            <h3>转 专 砖</h3>
        </div>
        <!-- Previous results would go here -->
    </div>
</div>
{% endif %}

<!-- Getting Started Section (for new users) -->
{% if not analytics_accounts and not search_console_accounts %}
<div class="analysis-section">
    <div class="results-container" style="text-align: center; padding: 3rem 2rem;">
        <i class="fas fa-rocket" style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;"></i>
        <h3 style="margin-bottom: 1rem; color: var(--text-primary);"> 转!</h3>
        <p style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 500px; margin-left: auto; margin-right: auto;">
             转 拽 转转 注 转 砖, 专 转 砖转 Google Analytics -Search Console
        </p>
        <a href="{{ url_for('accounts') }}" class="btn btn-primary">
            <i class="fas fa-link"></i>
            专 砖转
        </a>
    </div>
</div>
{% endif %}

<!-- Quick Stats Overview (if accounts connected) -->
{% if analytics_accounts or search_console_accounts %}
<div class="analysis-section">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
        
        {% if analytics_accounts %}
        <div class="insight-card" style="text-align: center;">
            <h6 style="justify-content: center;">
                <i class="fas fa-chart-bar" style="color: var(--primary-color);"></i>
                Google Analytics
            </h6>
            <p style="font-size: 2rem; font-weight: 700; color: var(--primary-color); margin: 0.5rem 0;">{{ analytics_accounts|length }}</p>
            <p style="margin: 0;">{{ '砖 专' if analytics_accounts|length == 1 else '砖转 专' }}</p>
        </div>
        {% endif %}

        {% if search_console_accounts %}
        <div class="insight-card" style="text-align: center;">
            <h6 style="justify-content: center;">
                <i class="fas fa-search" style="color: var(--primary-color);"></i>
                Search Console
            </h6>
            <p style="font-size: 2rem; font-weight: 700; color: var(--primary-color); margin: 0.5rem 0;">{{ search_console_accounts|length }}</p>
            <p style="margin: 0;">{{ '转专 专' if search_console_accounts|length == 1 else '转专 专' }}</p>
        </div>
        {% endif %}

        <div class="insight-card" style="text-align: center;">
            <h6 style="justify-content: center;">
                <i class="fas fa-chart-line" style="color: var(--primary-color);"></i>
                转 
            </h6>
            <p style="font-size: 2rem; font-weight: 700; color: var(--primary-color); margin: 0.5rem 0;">2</p>
            <p style="margin: 0;">转  砖砖</p>
        </div>

        <div class="insight-card" style="text-align: center;">
            <h6 style="justify-content: center;">
                <i class="fas fa-clock" style="color: var(--primary-color);"></i>
                注 专
            </h6>
            <p style="font-size: 1.25rem; font-weight: 600; color: var(--primary-color); margin: 0.5rem 0;">注砖</p>
            <p style="margin: 0;">转 注</p>
        </div>
    </div>

    <!-- Quick Actions Suggestion -->
    <div class="results-container">
        <div class="results-header">
            <i class="fas fa-lightbulb"></i>
            <h3>  拽 ?</h3>
        </div>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
            <div style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 8px;">
                <h6 style="color: var(--text-primary); margin-bottom: 0.5rem;"> 拽 转 拽专转 转注 转</h6>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">  注专抓   转 拽专  注专 注 注专</p>
                <a href="/action/traffic-quality" class="btn btn-primary" style="font-size: 0.8rem; padding: 0.5rem 1rem;">转 转</a>
            </div>
            
            <div style="padding: 1rem; border: 1px solid var(--border-color); border-radius: 8px;">
                <h6 style="color: var(--text-primary); margin-bottom: 0.5rem;"> 转 驻砖  拽转 砖</h6>
                <p style="color: var(--text-secondary); font-size: 0.875rem; margin-bottom: 1rem;">拽  转 驻转 转  专 转注  砖驻专</p>
                <a href="/action/search-keywords" class="btn btn-primary" style="font-size: 0.8rem; padding: 0.5rem 1rem;">转 转</a>
            </div>
        </div>
    </div>
</div>
{% endif %}

<script>
// Search functionality with autocomplete
const searchInput = document.getElementById('searchInput');
const quickActions = document.querySelectorAll('.action-pill');

// Create suggestions array
const suggestions = [];
quickActions.forEach(pill => {
    const text = pill.textContent.trim();
    const description = pill.getAttribute('data-description');
    if (text && description) {
        suggestions.push({
            title: text,
            description: description,
            href: pill.href || '#',
            element: pill
        });
    }
});

// Search input event listeners
searchInput.addEventListener('input', function() {
    const query = this.value.toLowerCase();
    
    // Highlight matching pills
    quickActions.forEach(pill => {
        const text = pill.textContent.toLowerCase();
        if (query && text.includes(query)) {
            pill.classList.add('active');
        } else {
            pill.classList.remove('active');
        }
    });
});

// Action pill click handlers
quickActions.forEach(pill => {
    pill.addEventListener('click', function(e) {
        const description = this.getAttribute('data-description');
        if (description) {
            searchInput.value = description;
            
            // Remove active from all pills
            quickActions.forEach(p => p.classList.remove('active'));
            // Add active to clicked pill
            this.classList.add('active');
        }
    });
});

// Perform search function
function performSearch() {
    const query = searchInput.value.trim();
    if (!query) return;
    
    // Find matching action
    const matchingAction = Array.from(quickActions).find(pill => {
        const description = pill.getAttribute('data-description');
        return description && (description.includes(query) || query.includes(description.substring(0, 20)));
    });
    
    if (matchingAction && matchingAction.href && matchingAction.href !== '#') {
        window.location.href = matchingAction.href;
    } else {
        // Show coming soon message
        showComingSoon('驻砖 转拽');
    }
}

// Enter key handler
searchInput.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        performSearch();
    }
});

// Coming soon function
function showComingSoon(feature) {
    // Create and show a nice modal or toast
    const toast = document.createElement('div');
    toast.style.cssText = `
        position: fixed;
        top: 2rem;
        right: 50%;
        transform: translateX(50%);
        background: var(--primary-color);
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: var(--shadow-md);
        z-index: 9999;
        font-weight: 500;
        animation: slideDown 0.3s ease;
    `;
    toast.innerHTML = `
        <i class="fas fa-info-circle" style="margin-left: 0.5rem;"></i>
        ${feature}   拽专!
    `;
    
    // Add animation
    const style = document.createElement('style');
    style.textContent = `
        @keyframes slideDown {
            from { transform: translateX(50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(50%) translateY(0); opacity: 1; }
        }
    `;
    document.head.appendChild(style);
    
    document.body.appendChild(toast);
    
    // Remove after 3 seconds
    setTimeout(() => {
        toast.style.animation = 'slideDown 0.3s ease reverse';
        setTimeout(() => {
            if (toast.parentNode) {
                toast.parentNode.removeChild(toast);
            }
        }, 300);
    }, 3000);
}

// Auto-focus search on page load
document.addEventListener('DOMContentLoaded', function() {
    searchInput.focus();
});
</script>
{% endblock %}